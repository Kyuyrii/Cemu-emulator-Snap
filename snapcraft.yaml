name: cemu-emulator
base: core24
version: '2.6'
platforms:
  amd64:
    build-on: [amd64]
    build-for: [amd64]
summary: Nintendo Wii U Emulator
description: |
  Cemu is a Nintendo Wii U emulator that is able to run most Wii U games and homebrew in a playable state. Created by Exzap, and written in C/C++.

  This emulator aims at providing both high-accuracy and performance, and is actively being developed with new features and fixes to increase compatibility, convenience and usability.

  It was written from scratch and development on the project began roughly early 2015.
grade: stable
confinement: strict
icon: info.cemu.Cemu.png

apps:
  cemu-emulator:
    command: usr/bin/Cemu
    desktop: info.cemu.Cemu.desktop
    common-id: info.cemu.Cemu
    extensions: [gnome]
    plugs:
      - unity7
      - screen-inhibit-control
      - audio-playback
      - network
      - network-bind
      - network-status
      - home
      - removable-media
      - mount-observe
      - joystick
      - bluez

plugs:
  shared-memory:
    private: true

parts:
  cemu-app:
    plugin: dump
    source: https://github.com/cemu-project/Cemu/releases/download/v$SNAPCRAFT_PROJECT_VERSION/cemu-$SNAPCRAFT_PROJECT_VERSION-ubuntu-22.04-x64.zip
    override-build: |
      craftctl default
      chmod +x $CRAFT_PART_INSTALL/Cemu_$SNAPCRAFT_PROJECT_VERSION/Cemu
    organize:
      Cemu_$SNAPCRAFT_PROJECT_VERSION/Cemu: usr/bin/Cemu
      Cemu_$SNAPCRAFT_PROJECT_VERSION/gameProfiles: usr/share/Cemu/gameProfiles
      Cemu_$SNAPCRAFT_PROJECT_VERSION/resources: usr/share/Cemu/resources
    prime:
      - usr/bin/Cemu
      - usr/share/Cemu/gameProfiles
      - usr/share/Cemu/resources

  dependencies:
    after: [cemu-app]
    plugin: nil
    stage-packages:
      - libbluetooth3
    prime:
      - usr/lib/$CRAFT_ARCH_TRIPLET_BUILD_FOR/libbluetooth.so*

  desktop-file:
    after: [dependencies]
    plugin: nil
    build-packages: [curl]
    override-build: |
      curl -o $CRAFT_PART_INSTALL/info.cemu.Cemu.desktop https://raw.githubusercontent.com/cemu-project/Cemu/refs/heads/main/dist/linux/info.cemu.Cemu.desktop
      sed -i 's|Name=Cemu|Name=Cemu [Kyu]|' $CRAFT_PART_INSTALL/info.cemu.Cemu.desktop